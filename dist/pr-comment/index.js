#!/usr/bin/env node
(()=>{"use strict";var e={883:e=>{function getEnv(e,n=""){return process.env[e]??n}e.exports=async({github:e,context:n,core:t})=>{try{const o=getEnv("BUILD_FLOW_TYPE","unknown");const i=getEnv("IMAGE_TAGS");const r=getEnv("REGISTRY_URLS");const s=getEnv("PR_COMMENT_TEMPLATE");const a=getEnv("REGISTRY","both");const c=getEnv("RESOLVED_SHA",n.sha);t.info("ğŸ“ Generating PR comment...");t.debug(`Flow Type: ${o}`);t.debug(`Registry: ${a}`);const u={pr:{emoji:"ğŸ”§",title:"PR Build",description:"Feature development and testing",color:"#0366d6"},dev:{emoji:"ğŸ› ï¸",title:"Dev Build",description:"Development and testing",color:"#28a745"},patch:{emoji:"ğŸ”¥",title:"Patch Build",description:"Hotfix for production",color:"#d73a49"},wip:{emoji:"âš¡",title:"WIP Build",description:"Work in progress experiment",color:"#ffd33d"},staging:{emoji:"ğŸš€",title:"Staging Build",description:"Pre-production validation",color:"#ffd700"}};const l=o!=="unknown"?u[o]:u.wip;let p;if(s){t.info("Using custom PR comment template");p=s.replace(/{BUILD_FLOW}/g,o).replace(/{IMAGE_TAGS}/g,i).replace(/{REGISTRY_URLS}/g,r)}else{t.info("Using default PR comment template");const e=r.split("\n").filter((e=>e.trim()));const s=e.map((e=>`\`\`\`bash\n${e}\n\`\`\``)).join("\n\n");const u=n.payload.repository.html_url;const d=c.substring(0,7);const m=`${u}/commit/${c}`;const f={"docker-hub":"Docker Hub",ghcr:"GitHub Container Registry",both:"Docker Hub + GHCR"};const g=f[a]??a;const _=i.split(",").map((e=>e.trim())).filter((e=>e)).map((e=>`â€¢ \`${e}\``)).join("<br/>");p=`## ${l.emoji} Container Build Complete - ${l.title}\n\n**Build Status:** âœ… Success  \n**Flow Type:** \`${o}\`  \n**Description:** ${l.description}\n\n---\n\n### ğŸ“¦ Pull Image\n\n${s}\n\n---\n\n### ğŸ“‹ Build Details\n\n| Property | Value |\n|----------|-------|\n| **Flow Type** | \`${o}\` |\n| **Commit** | [\`${d}\`](${m}) |\n| **Registry** | ${g} |\n\n### ğŸ·ï¸ Image Tags\n\n${_}\n\n---\n\n### ğŸ” Testing Your Changes\n\n1. **Pull the image** using one of the commands above\n2. **Run the container** with your test configuration\n3. **Verify** the changes work as expected\n4. **Report** any issues in this PR\n\n---\n\n### ğŸš€ Quick Start\n\n\`\`\`bash\n# Pull and run the container\n${e[0]??"docker pull <image>"}\ndocker run <your-options> <image>\n\`\`\`\n\n---\n\n<sub>ğŸ¤– Powered by [Container Build Flow Action](https://github.com/wgtechlabs/container-build-flow-action)  \nğŸ’» with â¤ï¸ by [Waren Gonzaga](https://warengonzaga.com) under [WG Technology Labs](https://wgtechlabs.com), and [Him](https://www.youtube.com/watch?v=HHrxS4diLew&t=44s) ğŸ™</sub>`}let d=null;if(n.payload.pull_request){d=n.payload.pull_request.number;t.info(`ğŸ“‹ PR event detected: #${d}`)}else if(n.eventName==="push"&&n.ref){const o=n.ref.replace("refs/heads/","");t.info(`ğŸ” Push event detected on branch: ${o}`);t.info("Searching for associated pull requests...");try{const{data:i}=await e.rest.pulls.list({owner:n.repo.owner,repo:n.repo.repo,state:"open",head:`${n.repo.owner}:${o}`});const r=i[0];if(r){d=r.number;t.info(`âœ… Found associated PR #${d}`)}else{t.info("â„¹ï¸  No open PRs found for this branch")}}catch(e){const n=e instanceof Error?e.message:String(e);t.warning(`Failed to search for PRs: ${n}`)}}if(d){t.info(`ğŸ’¬ Posting comment to PR #${d}`);const{data:o}=await e.rest.issues.listComments({owner:n.repo.owner,repo:n.repo.repo,issue_number:d});const i=o.find((e=>e.user.type==="Bot"&&e.body.includes("Container Build Complete")));if(i){t.info(`ğŸ”„ Updating existing comment (ID: ${i.id})`);await e.rest.issues.updateComment({owner:n.repo.owner,repo:n.repo.repo,comment_id:i.id,body:p});t.info("âœ… Comment updated successfully")}else{t.info("âœ¨ Creating new comment");await e.rest.issues.createComment({owner:n.repo.owner,repo:n.repo.repo,issue_number:d,body:p});t.info("âœ… Comment created successfully")}t.setOutput("comment-posted","true");t.info("âœ… Step 3: PR comment complete!")}else{t.info("â„¹ï¸  No associated pull request found, skipping comment");t.setOutput("comment-posted","false")}}catch(e){const n=e instanceof Error?e.message:String(e);const o=e instanceof Error?e.stack??"":"";t.setFailed(`Failed to post PR comment: ${n}`);if(o){t.debug(o)}}}}};var n={};function __nccwpck_require__(t){var o=n[t];if(o!==undefined){return o.exports}var i=n[t]={exports:{}};var r=true;try{e[t](i,i.exports,__nccwpck_require__);r=false}finally{if(r)delete n[t]}return i.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var t=__nccwpck_require__(883);module.exports=t})();